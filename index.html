<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>نمودار Notion</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div style="width: 100%; max-width: 800px; margin: 20px auto;">
        <!-- نمودار میله‌ای: داده‌های Notion -->
        <canvas id="barChart"></canvas>
        
        <!-- نمودار خطی: اختیاری -->
        <canvas id="lineChart" style="margin-top: 40px;"></canvas>
    </div>

    <script>
        // لینک API Vercel خودت را اینجا جایگذاری کن
        const apiUrl = "https://notion-chart-vercel-64nc-qn8b7avzz-ghhhjs-projects-4dd3f7bb.vercel.app"; 

        async function fetchData() {
            try {
                const res = await fetch(apiUrl);
                const data = await res.json();

                // ستون‌ها: name و number (status)
                const labels = data.map(d => d.name);
                const values = data.map(d => d.status);

                // نمودار میله‌ای
                new Chart(document.getElementById("barChart").getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels,
                        datasets: [{
                            label: "تعداد وظایف",
                            data: values,
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.8)',
                                'rgba(54, 162, 235, 0.8)', 
                                'rgba(75, 192, 192, 0.8)',
                                'rgba(255, 159, 64, 0.8)',
                                'rgba(153, 102, 255, 0.8)',
                                'rgba(255, 206, 86, 0.8)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'توزیع وضعیت وظایف'
                            },
                            legend: { display: false }
                        },
                        scales: { 
                            y: { beginAtZero: true, ticks: { stepSize: 1 } } 
                        }
                    }
                });

                // نمودار خطی (اختیاری)
                const lineLabels = data.map(d => d.name); // می‌توانی تغییر بدهی
                const lineValues = data.map(d => d.status); // می‌توانی تغییر بدهی

                new Chart(document.getElementById("lineChart").getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: lineLabels,
                        datasets: [{
                            label: "تعداد وظایف",
                            data: lineValues,
                            borderColor: 'rgba(75, 192, 192, 1)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            tension: 0.1,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'روند وظایف'
                            }
                        },
                        scales: { y: { beginAtZero: true } }
                    }
                });

            } catch (err) {
                console.error("خطا در دریافت داده‌ها:", err);
            }
        }

        fetchData();
    </script>
</body>
</html>
